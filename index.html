<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>NANA LAB V41.2</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&family=Orbitron:wght@700;900&family=Noto+Serif+KR&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00ffcc; --bg: #000b1a; --card-bg: rgba(0, 255, 204, 0.05); --card-border: rgba(0, 255, 204, 0.2); }
        
        /* ğŸš« ë©”ì¸ ìŠ¤í¬ë¡¤ ê³ ì • ë° ì „ì²´ í™˜ê²½ ì„¤ì • */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100%; height: 100%; overflow: hidden; background: var(--bg); position: fixed; }
        body { color: #fff; font-family: 'Noto Sans KR', sans-serif; }

        #galaxy-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%); }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--dur) infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        /* ğŸ“ ë ˆì´ì•„ì›ƒ ë°¸ëŸ°ì‹±: ì¤‘ì‹¬ë¶€ í•˜í–¥ ì¡°ì • */
        .container { max-width: 800px; margin: 0 auto; padding: 12vh 20px 0; text-align: center; height: 100vh; }
        
        /* ì»¤í”Œ ì´ë¯¸ì§€ (ê³ ì • ë° í„°ì¹˜ ê¸ˆì§€) */
        .main-profile { width: 130px; height: 130px; border-radius: 50%; border: 3px solid var(--neon); margin: 0 auto 20px; background: url('./profile.png') center/cover no-repeat, #222; box-shadow: 0 0 25px rgba(0, 255, 204, 0.3); pointer-events: none; }
        
        h1 { font-family: 'Orbitron', sans-serif; font-size: 2.2rem; letter-spacing: 5px; margin-bottom: 40px; text-shadow: 0 0 15px var(--neon); }

        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-width: 600px; margin: 0 auto 40px; }
        .menu-item { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 15px; padding: 20px 10px; cursor: pointer; transition: 0.3s; backdrop-filter: blur(10px); }
        .menu-item:hover { background: rgba(0, 255, 204, 0.15); border-color: var(--neon); transform: translateY(-3px); }
        .menu-item span { font-size: 28px; display: block; margin-bottom: 8px; }
        .menu-item h3 { font-size: 13px; color: var(--neon); letter-spacing: 1px; }

        /* ğŸ›¡ï¸ ëª¨ë“ˆ í”ë“¤ë¦¼ ë°©ì§€ ë ˆì´ì•„ì›ƒ */
        .module { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 95%; max-width: 800px; max-height: 92vh;
            background: rgba(0, 10, 25, 0.98); border: 1px solid var(--neon); border-radius: 20px; 
            padding: 25px; z-index: 100; overflow-y: auto; backdrop-filter: blur(30px);
        }

        .top-toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .nav-icon { cursor: pointer; font-size: 28px; color: var(--neon); opacity: 0.8; transition: 0.3s; padding: 5px; }
        .header-tools { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid rgba(0, 255, 204, 0.2); }
        .tab-container { display: flex; gap: 10px; }
        .tab { cursor: pointer; padding: 8px 10px; font-size: 11px; font-family: 'Orbitron'; color: #666; transition: 0.3s; }
        .tab.active { color: var(--neon); border-bottom: 2px solid var(--neon); }
        .clear-btn { cursor: pointer; font-size: 20px; color: var(--neon); opacity: 0.6; padding: 5px; }

        input, textarea { width: 100%; padding: 12px; background: rgba(0,0,0,0.4); border: 1px solid #333; color: #fff; border-radius: 10px; margin-bottom: 10px; outline: none; font-size: 15px; }
        .btn-fire { width: 100%; padding: 15px; background: transparent; color: var(--neon); border: 1px solid var(--neon); border-radius: 10px; font-weight: bold; cursor: pointer; font-family: 'Orbitron'; letter-spacing: 2px; }
        .btn-fire:disabled { opacity: 0.5; cursor: not-allowed; }
        
        #res-box { margin-top: 20px; white-space: pre-wrap; font-family: 'Noto Serif KR', serif; line-height: 1.8; color: #dfdfdf; font-size: 17px; }

        /* ğŸ“œ íˆìŠ¤í† ë¦¬ 10ê°œ ê³ ì • */
        .hist-btn { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); cursor: pointer; font-family: 'Orbitron'; font-size: 10px; color: var(--neon); opacity: 0.4; letter-spacing: 1px; }
        #history-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:1000; align-items:center; justify-content:center; backdrop-filter:blur(10px); }
        #history-modal { background: var(--bg); border:1px solid var(--neon); padding:30px; border-radius:20px; width:85%; max-width:450px; }
        .hist-item { display:flex; font-size:11px; margin-bottom:8px; text-align:left; color:rgba(255,255,255,0.7); }
        .hist-ver { color:var(--neon); width:60px; font-weight:bold; }
    </style>
</head>
<body>
    <div id="galaxy-bg"></div>

    <div class="container" id="main-hub">
        <div class="main-profile"></div>
        <h1>NANA LAB</h1>
        <div style="max-width:300px; margin: 0 auto 30px;">
            <input type="password" id="globalKey" placeholder="STATION API KEY" onchange="saveKey()" style="text-align:center; font-size:12px; padding:8px; border-color:rgba(0,255,204,0.3);">
        </div>
        <div class="menu-grid">
            <div class="menu-item" onclick="showModule('trans-mod')"><span>ğŸ“š</span><h3>ì†Œì„¤ ë²ˆì—­ê¸°</h3></div>
            <div class="menu-item" style="opacity:0.3;"><span>ğŸ¬</span><h3>ë‹¤ìš´ë¡œë”</h3></div>
            <div class="menu-item" style="opacity:0.3;"><span>â“</span><h3>ë¯¸ì •</h3></div>
        </div>
        <div class="hist-btn" onclick="openHistory()">â–¸ SYSTEM LOG [V41.2]</div>
    </div>

    <div class="module" id="trans-mod">
        <div class="top-toolbar">
            <div class="nav-icon" onclick="hideModule()">ğŸ </div>
            <h3 style="color: var(--neon); font-family: 'Orbitron'; font-size: 14px;">FLASH RAPID ENGINE</h3>
            <div style="width:30px;"></div> 
        </div>
        <div class="header-tools">
            <div class="tab-container">
                <div class="tab active" id="tab-text" onclick="switchTab('text')">TEXT</div>
                <div class="tab" id="tab-url" onclick="switchTab('url')">URL</div>
            </div>
            <div class="clear-btn" onclick="clearAll()">ğŸ—‘ï¸</div>
        </div>
        <div id="input-area"><textarea id="inpText" style="height:350px;" placeholder="ì¤‘êµ­ì–´ ì›ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea></div>
        <div id="step-log" style="font-size: 10px; color: var(--neon); margin-bottom: 10px; height: 12px; font-family: 'Orbitron'; opacity: 0.6;"></div>
        <button class="btn-fire" id="fireBtn" onclick="fireEngine()">FIRE ENGINE</button>
        <div id="res-box"></div>
    </div>

    <div id="history-overlay" onclick="closeHistory()">
        <div id="history-modal" onclick="event.stopPropagation()">
            <h3 style="font-family:'Orbitron'; color:var(--neon); margin-bottom:20px; font-size:14px;">HISTORY LOG</h3>
            <div id="hist-list">
                <div class="hist-item"><span class="hist-ver">V41.2</span> 1.5-Flash ëª¨ë¸ ê³ ì • ë° 4ì´ˆ ê°„ê²© ì—°ì‚¬ ëª¨ë“œ ìµœì í™”</div>
                <div class="hist-item"><span class="hist-ver">V41.1</span> 3.0 Preview ê·œê²© ëŒ€ì‘ ë° 8ì¤‘ ìš°íšŒ ì—”ì§„ í†µí•© ë³µêµ¬</div>
                <div class="hist-item"><span class="hist-ver">V41.0</span> API v1beta ëª¨ë¸ ê²½ë¡œ ë° í˜¸ì¶œ ê·œê²© ì •ë°€ ìˆ˜ì •</div>
                <div class="hist-item"><span class="hist-ver">V40.9</span> Candidates ì²´í¬ ê°•í™” ë° Undefined ì—ëŸ¬ ì™„ë²½ ì°¨ë‹¨</div>
                <div class="hist-item"><span class="hist-ver">V40.8</span> ë©”ì¸ ìŠ¤í¬ë¡¤ ê³ ì • ë° UI ì¤‘ì‹¬ë¶€ í•˜í–¥ ë ˆì´ì•„ì›ƒ ìµœì í™”</div>
                <div class="hist-item"><span class="hist-ver">V40.7</span> Claude ì„¤ê³„ 8ì¤‘ í¬ë¡¤ë§ ìš°íšŒ ì—”ì§„ ì‹œí€€ìŠ¤ ë„ì…</div>
                <div class="hist-item"><span class="hist-ver">V40.6</span> íƒ­ ì „í™˜ ì‹œ ì…ë ¥ì°½/ê²°ê³¼ì°½ ìë™ ì´ˆê¸°í™” ë¡œì§</div>
                <div class="hist-item"><span class="hist-ver">V40.5</span> ë²ˆì—­ë¬¸ í°íŠ¸ 17px ìµœì í™” ë° ê°€ë…ì„± ê°œì„ </div>
                <div class="hist-item"><span class="hist-ver">V40.4</span> UI ë¯¸ë‹ˆë©€í™” ë° í™ˆ ë‚´ë¹„ê²Œì´ì…˜ ì•„ì´ì½˜ í™•ëŒ€</div>
                <div class="hist-item"><span class="hist-ver">V40.3</span> ë¸Œë¼ìš°ì € íˆìŠ¤í† ë¦¬(ë’¤ë¡œê°€ê¸°) ì—°ë™ ê¸°ëŠ¥</div>
            </div>
        </div>
    </div>

<script>
    let currentMode = 'text';
    const saved = localStorage.getItem('nana_key');
    if(saved) document.getElementById('globalKey').value = saved;
    function saveKey() { localStorage.setItem('nana_key', document.getElementById('globalKey').value.trim()); }

    window.onpopstate = function() { hideModule(true); };
    function showModule(id) { history.pushState({page: id}, null, "#" + id); document.getElementById('main-hub').style.opacity='0'; setTimeout(()=> { document.getElementById('main-hub').style.display='none'; document.getElementById(id).style.display='block'; }, 200); }
    function hideModule(isPopState = false) { document.querySelectorAll('.module').forEach(m => m.style.display='none'); document.getElementById('main-hub').style.display='block'; document.getElementById('main-hub').style.opacity='1'; if(!isPopState && window.location.hash) history.back(); }

    function clearAll() { document.getElementById('inpText').value = ""; document.getElementById('res-box').innerText = ""; document.getElementById('step-log').innerText = ""; }
    
    function switchTab(mode) {
        currentMode = mode;
        document.getElementById('tab-text').classList.toggle('active', mode === 'text');
        document.getElementById('tab-url').classList.toggle('active', mode === 'url');
        clearAll();
        document.getElementById('inpText').placeholder = (mode === 'text') ? "ì¤‘êµ­ì–´ ì›ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." : "ë²ˆì—­í•  ì›¹í˜ì´ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”...";
        document.getElementById('inpText').style.height = (mode === 'text') ? "350px" : "60px";
    }

    // ğŸš€ 8ì¤‘ ìš°íšŒ í¬ë¡¤ë§ ì—”ì§„
    const STRATEGIES = [
        { name: 'PATH 1', fetch: async (u) => (await (await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(u)}`)).json()).contents },
        { name: 'PATH 2', fetch: async (u) => new TextDecoder('gbk').decode(await (await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`)).arrayBuffer()) },
        { name: 'PATH 3', fetch: async (u) => new TextDecoder('utf-8').decode(await (await fetch(`https://corsproxy.io/?${encodeURIComponent(u)}`)).arrayBuffer()) },
        { name: 'PATH 4', fetch: async (u) => await (await fetch(`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`)).text() },
        { name: 'PATH 5', fetch: async (u) => await (await fetch(`https://thingproxy.freeboard.io/fetch/${u}`)).text() },
        { name: 'PATH 6', fetch: async (u) => (await (await fetch(`https://htmldriven.com/cors-proxy?url=${encodeURIComponent(u)}`)).json()).body },
        { name: 'PATH 7', fetch: async (u) => await (await fetch(`https://corsproxy.io/?${encodeURIComponent(u)}`, {headers:{'Referer':new URL(u).origin}})).text() },
        { name: 'PATH 8', fetch: async (u) => (await (await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(u.replace('://','://m.'))}`)).json()).contents }
    ];

    async function fireEngine() {
        const key = document.getElementById('globalKey').value.trim();
        const input = document.getElementById('inpText').value.trim();
        const resBox = document.getElementById('res-box');
        const log = document.getElementById('step-log');
        const btn = document.getElementById('fireBtn');
        if(!key || !input) return alert("API KEYì™€ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”!");
        
        saveKey();
        btn.disabled = true;
        resBox.innerText = "ğŸš€ ì—”ì§„ ì í™” ì¤‘...";

        try {
            let finalContent = input;
            if(currentMode === 'url') {
                for(let s of STRATEGIES) {
                    log.innerText = `${s.name} ì¹¨íˆ¬ ì‹œë„ ì¤‘...`;
                    try { 
                        let html = await s.fetch(input); 
                        if(html.length > 500) {
                            const doc = new DOMParser().parseFromString(html, 'text/html');
                            // ì£¼ìš” ë³¸ë¬¸ íƒœê·¸ ìë™ ì¶”ì¶œ
                            finalContent = doc.querySelector('#content, #chaptercontent, .content, .post-content')?.innerText || doc.body.innerText.slice(0, 8000);
                            log.innerText = `${s.name} íƒˆì·¨ ì„±ê³µ! ë²ˆì—­ ì‹œì‘...`;
                            break;
                        }
                    } catch(e) {}
                }
            }

            // ğŸ“ [í¬ë¹„ì˜ íŒ ë°˜ì˜] 1.5-Flash ëª¨ë¸ë¡œ ê³ ì •í•˜ì—¬ ëŠê¹€ ë°©ì§€
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: `ì „ë¬¸ ë²ˆì—­ê°€ë¡œì„œ ë‹¤ìŒ ì¤‘ë¬¸ì„ í•œêµ­ì–´ êµ¬ì–´ì²´ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë²ˆì—­í•˜ë¼. ì¤‘êµ­ì–´ ë°œìŒ í‘œê¸° ì ˆëŒ€ ê¸ˆì§€. í•œêµ­ í•œììŒ ì‚¬ìš©. ì¸ì‚¬ë§ ì—†ì´ ë²ˆì—­ë³¸ë§Œ ì¶œë ¥:\n\n${finalContent}` }] }]
                })
            });

            const data = await response.json();

            if (data.error) {
                if(data.error.code === 429) resBox.innerText = "âš ï¸ [429 ERROR] ìš”ì²­ í•œë„ ì´ˆê³¼! ì ì‹œ í›„(5ì´ˆ) ë²„íŠ¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤.";
                else resBox.innerText = `âŒ API ì—ëŸ¬: ${data.error.message}`;
            } else if (data.candidates && data.candidates[0].content) {
                resBox.innerText = data.candidates[0].content.parts[0].text;
                log.innerText = "TRANSLATION COMPLETED.";
            } else {
                resBox.innerText = "âŒ ì‘ë‹µ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. API í‚¤ë¥¼ í™•ì¸í•˜ì„¸ìš”.";
            }
        } catch(e) { 
            resBox.innerText = `âŒ ì‹œìŠ¤í…œ ì˜¤ë¥˜: ${e.message}`;
        } finally { 
            // ğŸ“ [í¬ë¹„ì˜ íŒ ë°˜ì˜] ìš”ì²­ ê°„ê²© 4ì´ˆ ê°•ì œ ìœ ì§€
            setTimeout(() => { btn.disabled = false; }, 4000); 
        }
    }

    // ë°°ê²½ ë³„ ìƒì„± ë¡œì§
    const bg = document.getElementById('galaxy-bg');
    for(let i=0; i<150; i++){
        const s = document.createElement('div'); s.className = 'star';
        s.style.left = Math.random()*100+'%'; s.style.top = Math.random()*100+'%';
        const sz = Math.random()*1.5+0.5; s.style.width = sz+'px'; s.style.height = sz+'px';
        s.style.setProperty('--dur', Math.random()*3+2+'s'); bg.appendChild(s);
    }

    function openHistory() { document.getElementById('history-overlay').style.display='flex'; }
    function closeHistory() { document.getElementById('history-overlay').style.display='none'; }
</script>
</body>
</html>
