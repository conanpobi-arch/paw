<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>NANA LAB V38.0 - í•˜ì´ë¸Œë¦¬ë“œ ë²ˆì—­ê¸°</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Noto+Sans+KR:wght@300;400;500&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --neon: #00ffcc;
    --neon2: #00cfff;
    --paper: #000b1a;
    --border: rgba(0, 255, 204, 0.2);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body, html {
    width: 100%; min-height: 100vh;
    color: #fff;
    font-family: 'Noto Sans KR', sans-serif;
    overflow-x: hidden;
    background: transparent;
  }

  /* âœ… ì€í•˜ìˆ˜ ë°°ê²½ - bodyì— ë°°ê²½ ì—†ì• ê³  ë³„ë„ divë¡œ ë¶„ë¦¬ */
  #galaxy-bg {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
    background: radial-gradient(ellipse at 30% 40%, #0d1b3e 0%, #050a14 50%, #000205 100%);
    overflow: hidden;
  }

  #galaxy-bg::before {
    content: '';
    position: absolute;
    top: -20%; left: -10%;
    width: 70%; height: 70%;
    background: radial-gradient(ellipse, rgba(0,100,255,0.08) 0%, transparent 60%);
    animation: nebula-drift 20s ease-in-out infinite alternate;
  }

  #galaxy-bg::after {
    content: '';
    position: absolute;
    bottom: -10%; right: -10%;
    width: 60%; height: 60%;
    background: radial-gradient(ellipse, rgba(0,255,150,0.06) 0%, transparent 60%);
    animation: nebula-drift 25s ease-in-out infinite alternate-reverse;
  }

  @keyframes nebula-drift {
    from { transform: translate(0,0) scale(1); }
    to { transform: translate(40px,30px) scale(1.1); }
  }

  /* âœ… ë³„: #galaxy-bg ì•ˆì— position:absoluteë¡œ ì˜¬ë°”ë¥´ê²Œ ë°°ì¹˜ë¨ */
  .star {
    position: absolute;
    background: white;
    border-radius: 50%;
    animation: twinkle var(--dur, 3s) ease-in-out infinite;
    animation-delay: var(--delay, 0s);
  }

  @keyframes twinkle {
    0%, 100% { opacity: 0.1; transform: scale(0.7); }
    50% { opacity: 1; transform: scale(1.2); }
  }

  .meteor {
    position: absolute;
    width: 2px; height: 80px;
    background: linear-gradient(to bottom, rgba(0,255,204,0.8), transparent);
    animation: meteor-fall var(--mdur,4s) linear infinite;
    animation-delay: var(--mdelay,0s);
    opacity: 0;
    border-radius: 2px;
    transform: rotate(-45deg);
  }

  @keyframes meteor-fall {
    0% { opacity: 0; transform: rotate(-45deg) translateY(-100px); }
    10% { opacity: 1; }
    40% { opacity: 0; transform: rotate(-45deg) translateY(400px); }
    100% { opacity: 0; }
  }

  /* ì½˜í…ì¸  ë ˆì´ì–´ */
  .container {
    position: relative;
    z-index: 1;
    max-width: 820px;
    margin: 0 auto;
    padding: 40px 20px 80px;
  }

  header { text-align: center; margin-bottom: 44px; }

  .couple-main {
    width: 130px; height: 130px;
    border-radius: 50%;
    border: 2px solid var(--neon);
    background: url('./profile.png') center/cover no-repeat,
                radial-gradient(circle, #0d2a3a, #060e1a);
    box-shadow: 0 0 30px rgba(0,255,204,0.35), 0 0 60px rgba(0,255,204,0.1);
    margin: 0 auto 20px;
    animation: avatar-pulse 4s ease-in-out infinite;
  }

  @keyframes avatar-pulse {
    0%,100% { box-shadow: 0 0 25px rgba(0,255,204,0.3), 0 0 50px rgba(0,255,204,0.08); }
    50% { box-shadow: 0 0 45px rgba(0,255,204,0.6), 0 0 80px rgba(0,255,204,0.18); }
  }

  h1 {
    font-family: 'Orbitron', monospace;
    font-size: 22px;
    font-weight: 900;
    letter-spacing: 4px;
    color: #fff;
    text-shadow: 0 0 20px var(--neon), 0 0 40px rgba(0,255,204,0.3);
  }

  h1 span { color: var(--neon); }

  .version-tag {
    font-size: 10px;
    color: var(--neon);
    letter-spacing: 3px;
    margin-top: 8px;
    opacity: 0.75;
    font-family: 'Orbitron', monospace;
  }

  .card {
    background: rgba(0,15,35,0.75);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 28px;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    margin-bottom: 22px;
    position: relative;
    overflow: hidden;
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(to right, transparent, var(--neon), transparent);
    opacity: 0.5;
  }

  .card-title {
    font-family: 'Orbitron', monospace;
    font-size: 10px;
    letter-spacing: 3px;
    color: var(--neon);
    margin-bottom: 18px;
    opacity: 0.8;
  }

  label {
    display: block;
    font-size: 11px;
    color: var(--neon);
    margin-bottom: 7px;
    letter-spacing: 2px;
    font-weight: 500;
    opacity: 0.85;
  }ì˜¤í›„ 12:46 2026-02-18
  input[type="text"], input[type="password"], textarea {
    width: 100%;
    background: rgba(0,0,0,0.35);
    border: 1px solid rgba(0,255,204,0.15);
    border-radius: 12px;
    color: #e0ffe8;
    padding: 13px 16px;
    font-size: 14px;
    font-family: 'Noto Sans KR', sans-serif;
    outline: none;
    margin-bottom: 18px;
    transition: border-color 0.25s, box-shadow 0.25s;
    resize: vertical;
  }

  input:focus, textarea:focus {
    border-color: var(--neon);
    box-shadow: 0 0 0 3px rgba(0,255,204,0.1);
  }

  input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.2); }

  .mode-toggle {
    display: flex;
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 4px;
    margin-bottom: 20px;
    gap: 4px;
  }

  .mode-btn {
    flex: 1; padding: 9px;
    border-radius: 9px; border: none;
    background: transparent;
    color: rgba(255,255,255,0.4);
    font-size: 12px;
    font-family: 'Noto Sans KR', sans-serif;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.5px;
  }

  .mode-btn.active {
    background: rgba(0,255,204,0.15);
    color: var(--neon);
    font-weight: 500;
    box-shadow: 0 0 10px rgba(0,255,204,0.1);
  }

  .mode-panel { display: none; }
  .mode-panel.active { display: block; }

  .btn-fire {
    width: 100%; padding: 16px;
    background: linear-gradient(135deg, rgba(0,255,204,0.9), rgba(0,180,255,0.9));
    color: #000; border: none; border-radius: 14px;
    font-weight: 900; font-size: 16px;
    font-family: 'Orbitron', monospace;
    letter-spacing: 3px; cursor: pointer;
    transition: all 0.25s;
    position: relative; overflow: hidden;
  }

  .btn-fire::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
    transition: left 0.4s;
  }

  .btn-fire:hover::before { left: 100%; }
  .btn-fire:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,255,204,0.35); }
  .btn-fire:active { transform: translateY(0); }
  .btn-fire:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .loading { display: none; text-align: center; padding: 36px; }
  .loading.active { display: block; }

  .orbit {
    width: 48px; height: 48px;
    border: 2px solid rgba(0,255,204,0.15);
    border-top-color: var(--neon);
    border-radius: 50%;
    animation: orbit-spin 0.8s linear infinite;
    margin: 0 auto 14px;
  }

  @keyframes orbit-spin { to { transform: rotate(360deg); } }

  .loading-txt {
    font-family: 'Orbitron', monospace;
    font-size: 11px;
    color: var(--neon);
    letter-spacing: 2px;
    animation: blink 1.5s ease-in-out infinite;
  }

  @keyframes blink { 50% { opacity: 0.3; } }

  .loading-sub { font-size: 11px; color: rgba(255,255,255,0.35); margin-top: 6px; }

  .results { display: none; }
  .results.active { display: block; margin-top: 8px; }

  .result-tabs { display: flex; gap: 6px; margin-bottom: -1px; position: relative; z-index: 1; }

  .tab {
    padding: 9px 18px;
    background: rgba(0,0,0,0.4);
    border: 1px solid var(--border);
    border-bottom: none;
    border-radius: 10px 10px 0 0;
    cursor: pointer; font-size: 12px;
    color: rgba(255,255,255,0.4);
    letter-spacing: 1px; transition: all 0.2s;
  }

  .tab.active { background: rgba(0,255,204,0.12); color: var(--neon); font-weight: 600; }

  .tab-content {
    background: rgba(0,10,25,0.88);
    border: 1px solid var(--border);
    border-radius: 0 14px 14px 14px;
    padding: 24px;
    backdrop-filter: blur(20px);
    font-family: 'Noto Serif KR', serif;
    line-height: 1.95; white-space: pre-wrap;
    font-size: 15px; color: #e8f8f0;
    min-height: 120px;
  }

  .copy-btn {
    display: inline-block; margin-top: 16px;
    padding: 7px 16px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 8px; font-size: 11px;
    color: var(--neon); cursor: pointer;
    letter-spacing: 1px; opacity: 0.7;
    transition: all 0.2s;
  }

  .copy-btn:hover { opacity: 1; box-shadow: 0 0 10px rgba(0,255,204,0.2); }

  .error-box {
    display: none; margin-top: 14px;
    background: rgba(255,50,50,0.08);
    border: 1px solid rgba(255,80,80,0.3);
    border-radius: 10px; padding: 14px 18px;
    color: #ff8888; font-size: 13px;
    line-height: 1.7; white-space: pre-wrap;
  }

  .error-box.active { display: block; }

  .info-box {
    background: rgba(0,255,204,0.04);
    border: 1px solid rgba(0,255,204,0.12);
    border-radius: 10px; padding: 12px 16px;
    font-size: 11px; color: rgba(255,255,255,0.4);
    margin-bottom: 18px; line-height: 1.7;
  }

  .info-box a { color: var(--neon); opacity: 0.8; }

  .history-section {
    margin-top: 50px; padding-top: 24px;
    border-top: 1px solid var(--border);
  }

  .history-title {
    font-family: 'Orbitron', monospace;
    font-size: 10px; letter-spacing: 3px;
    color: var(--neon); margin-bottom: 14px; opacity: 0.6;
  }

  .hist-item {
    font-size: 11px; color: rgba(255,255,255,0.35);
    margin-bottom: 7px; display: flex; gap: 10px;
  }

  .hist-ver {
    color: var(--neon); font-weight: bold;
    font-family: 'Orbitron', monospace;
    font-size: 10px; min-width: 42px; opacity: 0.8;
  }
</style>
</head>
<body>

<div id="galaxy-bg"></div>

<div class="container">
  <header>
    <div class="couple-main"></div>
    <h1>NANA LAB <span>TRANSLATOR</span></h1>
    <div class="version-tag">STATION V38.0 Â· GEMINI HYBRID</div>
  </header>

  <div class="card">
    <div class="card-title">â–¸ SYSTEM CONFIG</div>

    <label>GEMINI API KEY (ë¬´ë£Œ)</label>
    <input type="password" id="apiKey" placeholder="AIzaSy...">
    <div class="info-box">
      ğŸ” API í‚¤ëŠ” ì´ ê¸°ê¸° ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.<br>
      ë¬´ë£Œ ë°œê¸‰: <a href="https://aistudio.google.com/app/apikey" target="_blank">aistudio.google.com</a>
    </div>

    <label>TRANSLATION MODE</label>
    <div class="mode-toggle">
      <button class="mode-btn active" onclick="setMode('url', this)">ğŸ”— URL í¬ë¡¤ë§</button>
      <button class="mode-btn" onclick="setMode('text', this)">ğŸ“‹ ì§ì ‘ ì…ë ¥</button>
    </div>

    <div class="mode-panel active" id="panel-url">
      <label>ì†Œì„¤ ì±•í„° URL</label>
      <input type="text" id="urlInput" placeholder="https://www.69shu.com/txt/12345/chapter.htm">
    </div>

    <div class="mode-panel" id="panel-text">
      <label>ì›ë¬¸ ì§ì ‘ ì…ë ¥</label>
      <textarea id="textInput" style="height:180px;" placeholder="ì¤‘êµ­ì–´ ì†Œì„¤ ë‚´ìš©ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
    </div>

    <button class="btn-fire" id="fireBtn" onclick="fireEngine()">â–¶ ë‚˜ë‚˜ ì—”ì§„ ê°€ë™</button>
    <div class="error-box" id="errorBox"></div>
  </div>

  <div class="loading" id="loading">
    <div class="orbit"></div>
    <div class="loading-txt">ENGINE RUNNING</div>
    <div class="loading-sub" id="loadingStep">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...</div>
  </div>

  <div class="results" id="results">
    <div class="result-tabs">
      <div class="tab active" onclick="switchTab('ko', this)">í•œêµ­ì–´ ë²ˆì—­</div>
      <div class="tab" onclick="switchTab('zh', this)">ì›ë¬¸ ë°ì´í„°</div>
    </div>
    <div class="tab-content" id="content-ko"></div>
    <div class="tab-content" id="content-zh" style="display:none;"></div>
    <button class="copy-btn" onclick="copyActive()">ğŸ“‹ ë³µì‚¬</button>
  </div>

  <div class="history-section">
    <div class="history-title">â–¸ VERSION HISTORY</div>
    <div class="hist-item"><span class="hist-ver">V38.0</span> Gemini API ë¬´ë£Œ ì—”ì§„ êµì²´ + CORS ë¬¸ì œ í•´ê²°</div>
    <div class="hist-item"><span class="hist-ver">V37.0</span> Claude API ì—”ì§„ êµì²´ + ì€í•˜ìˆ˜ ë Œë”ë§ ìˆ˜ì • + URL í¬ë¡¤ë§ í†µí•©</div>
    <div class="hist-item"><span class="hist-ver">V36.0</span> í´ë¡œë“œ UI êµ¬ì¡° + ì œë¯¸ë‚˜ì´ ì—”ì§„ í•˜ì´ë¸Œë¦¬ë“œ í†µí•©</div>
    <div class="hist-item"><span class="hist-ver">V35.0</span> í´ë¡œë“œ í•©ë™ ë¶„ì„ ë°˜ì˜ ë° ì—”ì§„ ê²½ë¡œ ì •ê·œí™”</div>
    <div class="hist-item"><span class="hist-ver">V34.0</span> CSS ì€í•˜ìˆ˜ ì—”ì§„ ë° API í‚¤ ê°±ì‹  ë§í¬ ì¶”ê°€</div>
    <div class="hist-item"><span class="hist-ver">V33.0</span> ì™¸ë¶€ ì´ë¯¸ì§€ ì°¨ë‹¨ ë°©ì§€ìš© CSS ì€í•˜ìˆ˜ ì‹œë²” ë„ì…</div>
    <div class="hist-item"><span class="hist-ver">V32.0</span> ëª¨ë¸ ìë™ íƒìƒ‰ ê¸°ëŠ¥ ë° ë°°ê²½ ì´ë¯¸ì§€ êµì²´</div>
    <div class="hist-item"><span class="hist-ver">V31.0</span> ê¹ƒí—ˆë¸Œ ë°°í¬ í™˜ê²½ ìµœì í™” ë° ëª¨ë¸ ë‹¤ê°í™”</div>
    <div class="hist-item"><span class="hist-ver">V30.0</span> ì—”ì§„ ê²½ë¡œ í‘œì¤€í™”(v1) ë° ì€í•˜ìˆ˜ ìµœì í™”</div>
    <div class="hist-item"><span class="hist-ver">V29.0</span> ì—”ì§„ ì ‘ë‘ì‚¬ 'models/' ê°•ì œ ì§€ì •</div>
    <div class="hist-item"><span class="hist-ver">V28.0</span> ë©”ì¸ ë²„ì „ ìƒì‹œ í‘œê¸° ë° íˆìŠ¤í† ë¦¬ ëª¨ë‹¬í™”</div>
  </div>
</div>

<script>
// âœ… ì€í•˜ìˆ˜ ìƒì„± - #galaxy-bg ì•ˆì—ì„œ position:absoluteë¡œ ìƒì„± (z-index ì¶©ëŒ í•´ê²°)
const galaxyBg = document.getElementById('galaxy-bg');

for (let i = 0; i < 220; i++) {
  const star = document.createElement('div');
  star.className = 'star';
  const size = Math.random() * 2.2 + 0.3;
  star.style.cssText = `
    left:${Math.random()*100}%;
    top:${Math.random()*100}%;
    width:${size}px;
    height:${size}px;
    --dur:${(Math.random()*3+2).toFixed(1)}s;
    --delay:${(Math.random()*4).toFixed(1)}s;
  `;
  galaxyBg.appendChild(star);
}

for (let i = 0; i < 5; i++) {
  const meteor = document.createElement('div');
  meteor.className = 'meteor';
  meteor.style.cssText = `
    left:${Math.random()*80+10}%;
    top:${Math.random()*40}%;
    --mdur:${(Math.random()*5+4).toFixed(1)}s;
    --mdelay:${(Math.random()*8).toFixed(1)}s;
  `;
  galaxyBg.appendChild(meteor);
}

// API í‚¤ ì €ì¥/ë³µì›
const savedKey = localStorage.getItem('nana_gemini_key');
if (savedKey) document.getElementById('apiKey').value = savedKey;
document.getElementById('apiKey').addEventListener('change', function() {
  if (this.value.trim()) localStorage.setItem('nana_gemini_key', this.value.trim());
});

let currentMode = 'url';
function setMode(mode, el) {
  currentMode = mode;
  document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('panel-url').classList.toggle('active', mode === 'url');
  document.getElementById('panel-text').classList.toggle('active', mode === 'text');
}

let activeTab = 'ko';
function switchTab(lang, el) {
  activeTab = lang;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('content-ko').style.display = lang === 'ko' ? 'block' : 'none';
  document.getElementById('content-zh').style.display = lang === 'zh' ? 'block' : 'none';
}

function setStep(msg) { document.getElementById('loadingStep').textContent = msg; }

async function fetchPage(url) {
  try {
    setStep('í˜ì´ì§€ ìˆ˜ì‹  ì¤‘... (ê²½ë¡œ 1/3)');
    const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`, { signal: AbortSignal.timeout(10000) });
    if (res.ok) { const d = await res.json(); if (d.contents?.length > 200) return d.contents; }
  } catch(e) {}

  try {
    setStep('í˜ì´ì§€ ìˆ˜ì‹  ì¤‘... (ê²½ë¡œ 2/3)');
    const res = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`, { signal: AbortSignal.timeout(10000) });
    if (res.ok) { const t = await res.text(); if (t.length > 200) return t; }
  } catch(e) {}

  try {
    setStep('í˜ì´ì§€ ìˆ˜ì‹  ì¤‘... (ê²½ë¡œ 3/3)');
    const res = await fetch(`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`, { signal: AbortSignal.timeout(10000) });
    if (res.ok) { const t = await res.text(); if (t.length > 200) return t; }
  } catch(e) {}

  throw new Error('í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nâ€¢ í•´ë‹¹ ì‚¬ì´íŠ¸ê°€ í¬ë¡¤ë§ì„ ì°¨ë‹¨í•¨\nâ€¢ ì˜ëª»ëœ URL\nâ€¢ CORS í”„ë¡ì‹œ ì„œë²„ ì¼ì‹œ ë¶ˆê°€\n\nì§ì ‘ ì…ë ¥ ëª¨ë“œë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”.');
}

function extractContent(html) {
  const doc = new DOMParser().parseFromString(html, 'text/html');
  ['script','style','nav','header','footer','aside','ins','iframe','noscript'].forEach(t => {
    doc.querySelectorAll(t).forEach(el => el.remove());
  });

  let title = '';
  const te = doc.querySelector('h1,h2,.title,#title,.chapter-title');
  if (te) title = te.textContent.trim();

  const selectors = ['#content','#chaptercontent','#chapter-content','#novel-content',
    '#readcontent','#articlecontent','#booktext','.content','.chapter-content',
    '.novel-content','.booktext','.dzs-content','.text-content'];

  let content = '';
  for (const sel of selectors) {
    const el = doc.querySelector(sel);
    if (el) { const t = el.textContent?.trim(); if (t?.length > 200) { content = t; break; } }
  }

  if (!content) {
    content = [...doc.querySelectorAll('p')].map(p => p.textContent.trim()).filter(t => t.length > 10).join('\n');
  }
  if (!content || content.length < 100) {
    content = doc.body?.textContent || '';
  }

  content = content.split('\n').map(l => l.trim()).filter(Boolean).join('\n').slice(0, 8000);
  return { title, content };
}

async function translateClaude(title, content, apiKey) {
  setStep('Gemini ì—”ì§„ ë²ˆì—­ ì¤‘... (10~30ì´ˆ ì†Œìš”)');
  const res = await fetch(
    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [{ parts: [{ text: `ì†Œì„¤ ë²ˆì—­ ì „ë¬¸ê°€ë¡œì„œ ë‹¤ìŒ ì¤‘êµ­ì–´ ì›¹ì†Œì„¤ì„ í•œêµ­ì–´ë¡œ ìœ ë ¤í•˜ê²Œ ë²ˆì—­í•˜ë¼.
í•œììŒì€ í•œêµ­ì‹ìœ¼ë¡œ í‘œê¸°í•˜ê³  ëŒ€í™”ì²´ëŠ” ìì—°ìŠ¤ëŸ½ê²Œ í•˜ë¼.
ë²ˆì—­ ê²°ê³¼ë§Œ ì¶œë ¥í•˜ê³ , ì œëª©ë„ ë²ˆì—­í•´ì„œ ë§¨ ìœ„ì— ì ì–´ë¼.

ì œëª©: ${title}

ë‚´ìš©:
${content}` }] }],
        generationConfig: { maxOutputTokens: 8000 }
      })
    }
  );

  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    if (res.status === 400) throw new Error('API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\naistudio.google.comì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”.');
    if (res.status === 429) throw new Error('API ìš”ì²­ í•œë„ ì´ˆê³¼ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    throw new Error(`Gemini ì—”ì§„ ì˜¤ë¥˜ (${res.status}): ${err.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
  }

  const data = await res.json();
  return data.candidates[0].content.parts[0].text;
}

async function fireEngine() {
  const apiKey = document.getElementById('apiKey').value.trim();
  const errorBox = document.getElementById('errorBox');
  const loading = document.getElementById('loading');
  const results = document.getElementById('results');
  const btn = document.getElementById('fireBtn');

  errorBox.classList.remove('active');
  results.classList.remove('active');

  if (!apiKey) { showError('Claude API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

  let title = '', content = '';

  if (currentMode === 'url') {
    const url = document.getElementById('urlInput').value.trim();
    if (!url || !url.startsWith('http')) { showError('ì˜¬ë°”ë¥¸ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
    btn.disabled = true;
    loading.classList.add('active');
    try {
      const html = await fetchPage(url);
      setStep('ì†Œì„¤ ë°ì´í„° ì¶”ì¶œ ì¤‘...');
      ({ title, content } = extractContent(html));
      if (!content || content.length < 50) throw new Error('ì†Œì„¤ ë‚´ìš©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì§ì ‘ ì…ë ¥ ëª¨ë“œë¡œ ì „í™˜í•´ë³´ì„¸ìš”.');
    } catch(e) {
      showError(e.message); btn.disabled = false; loading.classList.remove('active'); return;
    }
  } else {
    content = document.getElementById('textInput').value.trim();
    if (!content) { showError('ë²ˆì—­í•  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
    btn.disabled = true;
    loading.classList.add('active');
  }

  try {
    const translated = await translateClaude(title, content, apiKey);
    document.getElementById('content-ko').textContent = translated;
    document.getElementById('content-zh').textContent = (title ? title + '\n\n' : '') + content;
    document.getElementById('content-ko').style.display = 'block';
    document.getElementById('content-zh').style.display = 'none';
    document.querySelectorAll('.tab')[0].classList.add('active');
    document.querySelectorAll('.tab')[1].classList.remove('active');
    activeTab = 'ko';
    results.classList.add('active');
    results.scrollIntoView({ behavior: 'smooth', block: 'start' });
  } catch(e) {
    showError(e.message);
  } finally {
    btn.disabled = false;
    loading.classList.remove('active');
  }
}

function showError(msg) {
  const eb = document.getElementById('errorBox');
  eb.textContent = 'âš  ' + msg;
  eb.classList.add('active');
}

function copyActive() {
  const text = document.getElementById(activeTab === 'ko' ? 'content-ko' : 'content-zh').textContent;
  navigator.clipboard.writeText(text).then(() => alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'));
}

document.addEventListener('keydown', e => { if (e.key === 'Enter' && e.ctrlKey) fireEngine(); });
</script>
</body>
</html>
